# =============================================================================
# TASK 1: DEFINE VISUALIZATIONS
# =============================================================================
define_visuals_task:
  description: >
    Read the report 'action_recommendations.md' generated by the Action Advisor (Agent 3 from the previous team).

    Focus only on the sections that highlight issues or insights marked for visualization.

    For each visualization request:
    1. Suggest the most appropriate type of chart (e.g., bar, line, heatmap, scatter, etc.)
    2. Specify the relevant variables from the dataset
    3. Explain the purpose of the chart and what it aims to show
    4. Indicate the business message or insight the chart should communicate
    5. Prioritize the chart: High / Medium / Low importance

    ⚠️ Rules:
    - Do NOT invent data or variable names.
    - Base your planning only on the explicit content of the report.
    - You do not write code – just the visualization plan.

  expected_output: >
    Markdown file saved as 'viz_plan.md' with the following structure:

    ## Recommended Visualizations

    ### Issue 1: [Title]
    - **Chart Type:** [e.g. Line Chart]
    - **Variables:** [e.g. Profit by Month]
    - **Why this chart:** [Explain purpose]
    - **Insight to communicate:** [Business message]
    - **Priority:** [High/Medium/Low]

    [Repeat for each item]

  agent: viz_planner
  output_file: viz_plan.md

  # Note: This task reads 'action_recommendations.md' generated by the previous crew (DataAnalistCrew)
  # No context needed as this is the first task in the VisualizationCrew

# =============================================================================
# TASK 2: GENERATE VISUALIZATION CODE
# Agent: Viz Code Generator
# =============================================================================
generate_viz_code_task:
  description: >
    Your task is to generate Python code that creates visualizations based on structured requests.

    Input:
    - 'viz_plan.md' – a structured list of visualization requests (including chart types, variables, and business goals).
    - 'data_cleaned.csv' – the dataset from which all visualizations must be derived.

    For each visualization request:
    1. Read the description of the chart (type, variables, and insight to communicate).
    2. Generate clean, well-structured Python code using seaborn, matplotlib, or plotly.
    3. Include comments and descriptive titles, axis labels, and legends.
    4. Save each chart to a PNG or HTML file if applicable.

    Important Formatting:
    - Follow the exact Markdown formatting and section titles from 'viz_plan.md'.
    - Save the output as a Markdown file named 'visualization_code.md'.

    Critical Rules:
    - Never invent variable names – use CSVSearchTool to validate all columns from 'data_cleaned.csv'.
    - Do not include external data, synthetic values, or fields not present in the CSV.
    - If a variable from 'viz_plan.md' does not exist in the CSV, skip the chart and mark it in the output.
    - If a chart type is not specified, choose the most appropriate one based on the insight description.
    - Prefer seaborn for static charts, plotly for interactive ones.
    - Do not include explanations – only working code with inline comments.

  expected_output: >
    Markdown file 'visualization_code.md' containing one code block per chart, using the following format:

    ### Chart X: [Title or Insight]
    ```python
    [Python code here]
    ```

  agent: viz_code_generator

  context:
    - define_visuals_task

  output_file: visualization_code.md

# =============================================================================
# TASK 3: EXECUTE VISUALIZATIONS
# Agent: Viz Executor
# =============================================================================
execute_visualizations_task:
  description: >
    Your task is to review the visualization code from 'visualization_code.md'
    and create a single executable Python script.
    
    Steps:
    1. Read 'visualization_code.md'
    2. Extract all Python code blocks
    3. Combine them into one script: 'generate_charts.py'
    4. Add necessary imports at the top
    5. Add error handling
    6. Add comments explaining each chart
    7. Make sure the script saves charts as PNG/HTML files
    
    Rules:
    - Do NOT run the code - just create the script
    - Ensure all variable names match 'data_cleaned.csv'
    - Add print statements to track progress
    - Name output files: chart_1.png, chart_2.png, etc.
  
  expected_output: >
    Create a complete Python script that includes:
    
    1. All necessary imports (pandas, matplotlib, seaborn, plotly)
    2. Code to load 'data_cleaned.csv'
    3. All chart generation code from 'visualization_code.md'
    4. Error handling for each chart
    5. Print statements showing progress
    6. File saving for each chart (chart_1.png, chart_2.html, etc.)
    
    The script should be ready to run with: python generate_charts.py
    
    Also include at the end (as Python comments):
    - List of all charts that will be generated
    - Brief description of each
  
  agent: viz_executor
  context:
    - generate_viz_code_task
  
  output_file: generate_charts.py